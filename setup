#!/usr/bin/env bash
set -exou pipefail

sudo mkdir -p /usr/"$USER"
sudo cp ry /usr/"$USER"
sudo chmod +x /usr/"$USER"/ry

set +x
echo + cat requirements.txt
echo "$(cat requirements.txt)"
echo 🐍 installing requirements
printf "+ pip3 -q -q -q install -r requirements.txt 2>&1\n"
please_be_quiet=$(pip3 -q -q -q install -r requirements.txt 2>&1)
set -x

set +e
grep -q 'export PATH=\"/usr/\$USER:\$PATH\"' ~/.bashrc
grep_return=$?
set -e
if [[ $grep_return == 1 ]]; then
    echo "export PATH=\"/usr/\$USER:\$PATH\"" >> ~/.bashrc
fi

set +e
grep -q 'export RY=\"py\"' ~/.bashrc
grep_return=$?
set -e
if [[ $grep_return == 1 ]]; then
    echo "export RY=\"py\"" >> ~/.bashrc
fi

set +xH
printf "🐍 success! restart terminal to use ry\n"
